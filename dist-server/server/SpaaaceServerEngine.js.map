{"version":3,"file":"SpaaaceServerEngine.js","names":["_lanceGg","require","_classCallCheck","a","n","TypeError","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","_superPropGet","p","_get","get","bind","_superPropBase","getOwnPropertyDescriptor","arguments","value","hasOwnProperty","setPrototypeOf","getPrototypeOf","__proto__","_inherits","create","_setPrototypeOf","nameGenerator","NUM_BOTS","SpaaaceServerEngine","exports","_ServerEngine","io","gameEngine","inputOptions","_this","scoreData","start","_this2","x","makeBot","on","missile","ownerId","kills","ship","id","updateScore","console","log","concat","toString","removeObjectFromWorld","isBot","setTimeout","onPlayerConnected","socket","_this3","makePlayerShip","makeShip","playerId","name","onPlayerDisconnected","socketId","_this4","playerObjects","world","queryObjects","forEach","obj","bot","attachAI","_this5","sockets","emit","ServerEngine"],"sources":["../../src/server/SpaaaceServerEngine.js"],"sourcesContent":["import { ServerEngine } from 'lance-gg';\nconst nameGenerator = require('./NameGenerator');\nconst NUM_BOTS = 3;\n\nexport default class SpaaaceServerEngine extends ServerEngine {\n\n    constructor(io, gameEngine, inputOptions) {\n        super(io, gameEngine, inputOptions);\n        this.scoreData = {};\n    }\n\n    // when the game starts, create robot spaceships, and register\n    // on missile-hit events\n    start() {\n        super.start();\n\n        for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\n\n        this.gameEngine.on('missileHit', e => {\n\n            // add kills\n            if (this.scoreData[e.missile.ownerId]) this.scoreData[e.missile.ownerId].kills++;\n\n            // remove score data for killed ship\n            delete this.scoreData[e.ship.id];\n            this.updateScore();\n\n            console.log(`ship killed: ${e.ship.toString()}`);\n            this.gameEngine.removeObjectFromWorld(e.ship.id);\n            if (e.ship.isBot) {\n                setTimeout(() => this.makeBot(), 5000);\n            }\n        });\n    }\n\n    // a player has connected\n    onPlayerConnected(socket) {\n        super.onPlayerConnected(socket);\n\n        let makePlayerShip = () => {\n            let ship = this.gameEngine.makeShip(socket.playerId);\n\n            this.scoreData[ship.id] = {\n                kills: 0,\n                name: nameGenerator('general')\n            };\n            this.updateScore();\n        };\n\n        // handle client restart requests\n        socket.on('requestRestart', makePlayerShip);\n    }\n\n    // a player has disconnected\n    onPlayerDisconnected(socketId, playerId) {\n        super.onPlayerDisconnected(socketId, playerId);\n\n\n        // iterate through all objects, delete those that are associated with the player (ship and missiles)\n        let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\n        playerObjects.forEach( obj => {\n            this.gameEngine.removeObjectFromWorld(obj.id);\n            // remove score associated with this ship\n            delete this.scoreData[obj.id];\n        });\n\n        this.updateScore();\n    }\n\n    // create a robot spaceship\n    makeBot() {\n        let bot = this.gameEngine.makeShip(0);\n        bot.attachAI();\n\n        this.scoreData[bot.id] = {\n            kills: 0,\n            name: nameGenerator('general') + 'Bot'\n        };\n\n        this.updateScore();\n    }\n\n    updateScore() {\n        // delay so player socket can catch up\n        setTimeout(() => {\n            this.io.sockets.emit('scoreUpdate', this.scoreData);\n        }, 1000);\n\n    }\n}\n"],"mappings":"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","ignoreList":[]}