{"version":3,"file":"SpaaaceClientEngine.js","names":["_howler","_interopRequireDefault","require","_lanceGg","_SpaaaceRenderer","_MobileControls","_Ship","_Utils","e","__esModule","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","_superPropGet","p","_get","get","bind","_superPropBase","getOwnPropertyDescriptor","arguments","value","hasOwnProperty","setPrototypeOf","getPrototypeOf","__proto__","_inherits","create","_setPrototypeOf","SpaaaceClientEngine","exports","_ClientEngine","gameEngine","options","SpaaaceRenderer","start","_this","on","obj","Ship","isOwnedByPlayer","document","body","classList","add","querySelector","disabled","once","addEventListener","Utils","isTouchDevice","renderer","enableFullScreen","socket","emit","clickEvent","currentTarget","window","location","reload","controls","MobileControls","sendInput","KeyboardControls","bindKey","repeat","assetPathPrefix","sounds","missileHit","Howl","src","fireMissile","play","playerShip","networkMonitor","updateHUD","connect","_this2","then","updateScore","console","log","remove","getUrlVars","ClientEngine"],"sources":["../../src/client/SpaaaceClientEngine.js"],"sourcesContent":["import Howler from 'howler'; // eslint-disable-line no-unused-vars\nimport { ClientEngine, KeyboardControls } from 'lance-gg';\nimport SpaaaceRenderer from '../client/SpaaaceRenderer';\nimport MobileControls from './MobileControls';\nimport Ship from '../common/Ship';\nimport Utils from '../common/Utils';\n\nexport default class SpaaaceClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n        super(gameEngine, options, SpaaaceRenderer);\n    }\n\n    start() {\n        super.start();\n\n        // handle gui for game condition\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj instanceof Ship && this.gameEngine.isOwnedByPlayer(obj)) {\n                document.body.classList.add('lostGame');\n                document.querySelector('#tryAgain').disabled = false;\n            }\n        });\n\n        this.gameEngine.once('renderer.ready', () => {\n            // click event for \"try again\" button\n            document.querySelector('#tryAgain').addEventListener('click', () => {\n                if (Utils.isTouchDevice()){\n                    this.renderer.enableFullScreen();\n                }\n                this.socket.emit('requestRestart');\n            });\n\n            document.querySelector('#joinGame').addEventListener('click', (clickEvent) => {\n                if (Utils.isTouchDevice()){\n                    this.renderer.enableFullScreen();\n                }\n                clickEvent.currentTarget.disabled = true;\n                this.socket.emit('requestRestart');\n            });\n\n            document.querySelector('#reconnect').addEventListener('click', () => {\n                window.location.reload();\n            });\n\n            //  Game input\n            if (Utils.isTouchDevice()){\n                this.controls = new MobileControls(this);\n                this.controls.on('fire', () => {\n                    this.sendInput('space');\n                });\n            } else {\n                this.controls = new KeyboardControls(this);\n                this.controls.bindKey('left', 'left', { repeat: true });\n                this.controls.bindKey('right', 'right', { repeat: true });\n                this.controls.bindKey('up', 'up', { repeat: true } );\n                this.controls.bindKey('space', 'space');\n            }\n\n        });\n\n        // allow a custom path for sounds\n        let assetPathPrefix = this.options.assetPathPrefix ? this.options.assetPathPrefix : '';\n\n        // handle sounds\n        this.sounds = {\n            missileHit: new Howl({ src: [assetPathPrefix + 'assets/audio/193429__unfa__projectile-hit.mp3'] }),\n            fireMissile: new Howl({ src: [assetPathPrefix + 'assets/audio/248293__chocobaggy__weird-laser-gun.mp3'] })\n        };\n\n        this.gameEngine.on('fireMissile', () => { this.sounds.fireMissile.play(); });\n        this.gameEngine.on('missileHit', () => {\n            // don't play explosion sound if the player is not in game\n            if (this.renderer.playerShip) {\n                this.sounds.missileHit.play();\n            }\n        });\n\n        this.networkMonitor.on('RTTUpdate', (e) => {\n            this.renderer.updateHUD(e);\n        });\n    }\n\n    // extend ClientEngine connect to add own events\n    connect() {\n        return super.connect().then(() => {\n            this.socket.on('scoreUpdate', (e) => {\n                this.renderer.updateScore(e);\n            });\n\n            this.socket.on('disconnect', (e) => {\n                console.log('disconnected');\n                document.body.classList.add('disconnected');\n                document.body.classList.remove('gameActive');\n                document.querySelector('#reconnect').disabled = false;\n            });\n\n            if ('autostart' in Utils.getUrlVars()) {\n                this.socket.emit('requestRestart');\n            }\n        });\n    }\n\n}\n"],"mappings":"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","ignoreList":[]}